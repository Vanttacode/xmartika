---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';

// Componentes Wrapper (.astro)
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import Problem from '../components/Problem.astro';
import Features from '../components/Features.astro'; 
import HowItWorks from '../components/HowItWorks.astro';
import Partners from '../components/Partners.astro';
import Testimonials from '../components/Testimonials.astro';
import FAQ from '../components/FAQ.astro';
import CTASection from '../components/CTASection.astro';
import Footer from '../components/Footer.astro';

// Supabase & Config
import { supabase } from '../lib/supabase';
import { CLIENT_ID } from '../lib/constants'; // <--- ID del Cliente

let siteConfig: any = {};
let whatsappNum = "18295550000"; // Fallback

try {
  // CONSULTA FILTRADA POR CLIENT_ID
  let { data: configData } = await supabase
    .from('site_config')
    .select('*')
    .eq('client_id', CLIENT_ID);
  
  if (configData) {
    configData.forEach((item: any) => { 
      siteConfig[item.key] = item.value; 
    });
    
    if (siteConfig.whatsapp_number) {
      whatsappNum = siteConfig.whatsapp_number;
    }
  }
} catch (e) {
  console.error("Error Supabase:", e);
}
---

<Layout title="Xmartika | IngenierÃ­a Contable & BI para Startups en RD">
  
  <Header whatsappNumber={whatsappNum} />
  
  <main>
    <Hero whatsappNumber={whatsappNum} />
    <Problem />
    <Features /> 
    <HowItWorks whatsappNumber={whatsappNum} />
    <div id="partners">
      <Partners />
    </div>
    <Testimonials />
    <FAQ whatsappNumber={whatsappNum} />
    <CTASection whatsappNumber={whatsappNum} /> 
  </main>

  <Footer siteConfig={siteConfig} />
  
</Layout>